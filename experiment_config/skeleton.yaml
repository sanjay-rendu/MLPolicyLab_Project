experiment_name: skeleton1
owner: bills3_group

inputs:
  sql_loc: "/data/groups/bills3/mlpp_project_home/experiment_config/data_agg.sql"
  sql_loc1: "/data/groups/bills3/mlpp_project_home/experiment_config/progress.sql"
outputs:
  train_accuracy: '/data/groups/bills3/mlpp_data_store/skeleton1/train_report.txt'
  test_accuracy: '/data/groups/bills3/mlpp_data_store/skeleton1/test_report.txt'
  val_accuracy: '/data/groups/bills3/mlpp_data_store/skeleton1/val_report.txt'
  model: '/data/groups/bills3/mlpp_data_store/skeleton1/model.obj'

graph:
  - node_name: fetch
    inputs: sql_loc
    outputs: raw_data
    operation: data_io.fetch_sql

  - node_name: progress
    inputs: sql_loc1
    outputs: bill_progress
    operation: data_io.fetch_sql

  - node_name: labeled_data
    inputs: [fetch.raw_data, progress.bill_progress]
    outputs: labeled_data
    operation: get_labeled_data.get_labeled_data
    arguments:
      n: 6

  - node_name: data_eng
    inputs: labeled_data.labeled_data
    outputs: engg_data
    operation: data_clean.feature_eng
    arguments:
      index: 'bill_id'
      date: 'introduced_date'
      ohe_features: ['introduced_body', 'bill_type']
      summed_features: ['role_name', 'party_id']
      other_features: ['final_status']

  - node_name: split
    inputs: data_eng.engg_data
    outputs: [train, val, test]
    operation: split.split
    arguments:
        val_size: 0.1
        test_size: 0.2

  - node_name: model_logistic_regression
    inputs: split.train
    outputs: model
    operation: model.logistic_regression_trainer
    arguments:
      max_iter: 200

- node_name: train
    inputs: [split.train, model_logistic_regression.model]
    outputs: train_accuracy
    operation: model.accuracy
    arguments:
      threshold: 0.5

  - node_name: validate
    inputs: [split.val, model_logistic_regression.model]
    outputs: val_accuracy
    operation: model.accuracy
    arguments:
      threshold: 0.5

  - node_name: test
    inputs: [split.test, model_logistic_regression.model]
    outputs: test_accuracy
    operation: model.accuracy
    arguments:
      threshold: 0.5
