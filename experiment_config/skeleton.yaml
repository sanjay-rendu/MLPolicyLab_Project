experiment_name: skeleton1
owner: bills3_group

inputs:
  sql_loc_bill: "/data/groups/bills3/mlpp_project_home/experiment_config/bill.sql"
  sql_loc_progress: "/data/groups/bills3/mlpp_project_home/experiment_config/progress.sql"
outputs:
  train_accuracy: '/data/groups/bills3/mlpp_data_store/skeleton1/train_report.txt'
  test_accuracy: '/data/groups/bills3/mlpp_data_store/skeleton1/test_report.txt'
  val_accuracy: '/data/groups/bills3/mlpp_data_store/skeleton1/val_report.txt'

graph:
  - node_name: fetch_bill_data
    inputs: sql_loc_bill
    outputs: bill_data
    operation: data_io.fetch_sql

  - node_name: fetch_progress_data
    inputs: sql_loc_progress
    outputs: progress_data
    operation: data_io.fetch_sql

  - node_name: labeled_data
    inputs: [fetch_bill_data.bill_data, fetch_progress_data.progress_data]
    outputs: labeled_data
    operation: get_labeled_data.get_labeled_data
    arguments:
      n: 6

  - node_name: data_eng
    inputs: labeled_data.labeled_data
    outputs: processed_data
    operation: data_clean.feature_eng
    arguments:
      index: 'bill_id'
      date: 'introduced_date'
      ohe_features: ['introduced_body', 'bill_type']
      summed_features: ['role_name', 'party_id']
      other_features: ['final_status']

  - node_name: split
    inputs: data_eng.processed_data
    outputs: [train, val, test]
    operation: split.split
    arguments:
        val_size: 0.1
        test_size: 0.2

  - node_name: model_logistic_regression
    inputs: split.train
    outputs: model
    operation: model.logistic_regression_trainer
    arguments:
      target: final_status
      max_iter: 200

  - node_name: train
    inputs: [split.train, model_logistic_regression.model]
    outputs: train_accuracy
    operation: model.accuracy
    arguments:
      target: final_status
      threshold: 0.5

  - node_name: validate
    inputs: [split.val, model_logistic_regression.model]
    outputs: val_accuracy
    operation: model.accuracy
    arguments:
      target: final_status
      threshold: 0.5

  - node_name: test
    inputs: [split.test, model_logistic_regression.model]
    outputs: test_accuracy
    operation: model.accuracy
    arguments:
      target: final_status
      threshold: 0.5
